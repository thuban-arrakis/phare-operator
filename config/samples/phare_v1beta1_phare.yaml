apiVersion: phare.localcorp.internal/v1beta1
kind: Phare
metadata:
  labels:
    app.kubernetes.io/name: phare
    app.kubernetes.io/created-by: operator
  name: phare-sample
spec:
  microservice:
    kind: StatefulSet
    replicaCount: 1
    image:
      repository: nginx
      tag: latest
    command: ["nginx", "-g", "daemon off;"]
    ports:
      - containerPort: 80
    livenessProbe:
      httpGet:
        path: /
        port: 80
      initialDelaySeconds: 30
      periodSeconds: 10
    readinessProbe:
      httpGet:
        path: /
        port: 80
      initialDelaySeconds: 30
      periodSeconds: 10
    resourceRequirements:
      requests:
        memory: "128Mi"
        cpu: "500m"
      limits:
        memory: "128Mi"
        cpu: "500m"
    env:
      - name: PHARE_CONFIG
        value: /etc/phare/config.js
      - name: PHARE_CONFIG_KEY
        valueFrom:
          configMapKeyRef:
            name: phare-sample-config
            key: key
    volumes:
      - name: empty
        emptyDir: {}
    volumeMounts:
      - name: empty
        mountPath: /etc/phare
    initContainers:
      - name: init
        image: busybox
        command: ["sh", "-c", "echo init"]
        volumeMounts:
          - name: empty
            mountPath: /etc/phare
  service:
    ports:
      - name: http
        port: 80
        targetPort: 80
  toolchain:
    config:
      key: "{{ .Name }}"
      config.js: |
        module.exports = {
          key: "value"
        }
      template.js: |
        module.exports = {
          project: {
            name: "{{ .Name }}",
            namespace: "{{ .Namespace }}"
          }
        }
